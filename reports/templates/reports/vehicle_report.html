{% extends "base.html" %}
{% load leaflet_tags %}

{% block content %}
    <h2>Gerealiseerde ritten</h2>
    <p>Die in het afgelopen half uur reden</p>

    <table class="table table-striped table-condensed table-bordered col-lg-8">
        <tr>
            <th class="col-lg-2">Lijn</th>
            <th class="col-lg-3">Gereden</th>
            <th class="col-lg-3">Verwacht</th>
            <th class="col-lg-4">Percentage</th>
        </tr>
        {% for lijn in list|dictsort:"percentage" %}
            <tr class="line" data-line="{{ lijn.lineplanningnumber }}">
                <td><strong>{{ lijn.publiclinenumber }}</strong></td>
                <td>{{ lijn.seen }}</td>
                <td>{{ lijn.expected }}</td>
                <td>{{ lijn.percentage }}%
                    <a class="btn btn-primary btn-xs pull-right view-detail" data-toggle="collapse" data-target="#l{{ lijn.lineplanningnumber }}">
                        Details
                    </a>
                </td>
            </tr>
            <tr class="collapse" id="l{{ lijn.lineplanningnumber }}">
                <td></td>
                <td colspan="4">
                    <ul class="row">
                        {% for vehicle in lijn.list %}
                            {% if vehicle.log_id %}
                                <li class="col-xs-4">{{ vehicle.vehiclenumber }} - <small>Rit {{ vehicle.journeynumber }}</small></li>
                            {% else %}
                                <li class="col-xs-4"><small style="color: red;">Rit {{ vehicle.journeynumber }}</small></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </td>
            </tr>
        {% endfor %}
    </table>

    <h3>Voertuigposities</h3>
    {% leaflet_map "smallmap" callback="main_map_init" %}

{% endblock %}

{% block extra_css %}
    {% leaflet_css %}
{% endblock %}

{% block extra_js %}
    {% leaflet_js %}
{% endblock %}

{% block js %}
    function main_map_init (map, options) {
        map.setView(new L.LatLng(52.05, 4.32), 12);
        $.getJSON("{% url 'ajax_vehicles' %}", function (data) {
            // Add GeoJSON layer
            L.geoJson(data).addTo(map);
        });
    }
{% endblock %}