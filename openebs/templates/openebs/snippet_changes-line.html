{% load i18n filters %}

{% if line.grouper.publiclinenumber %}
    {% if line.grouper.lineplanningnumber != line.grouper.publiclinenumber %}
        <h4>{% trans "Lijn" %} {{ line.grouper.publiclinenumber }} ({{ line.grouper.lineplanningnumber }}) <small>{{ line.grouper.headsign }}</small></h4>
    {% else %}
        <h4>{% trans "Lijn" %} {{ line.grouper.publiclinenumber }} <small>{{ line.grouper.headsign }}</small></h4>
    {% endif %}
{% else %}
<h4>{% trans "Alle lijnen" %}</h4>
    {% trans "Alle ritten van vervoerder" as all_lines %}
{% endif %}

  <table class="table table-condensed table-bordered table-striped">
  <tr id="highlight">
      <th class="col-sm-2">{% trans "Ritdatum" %}</th>
      <th class="col-sm-2">{% trans "Begintijd" %}</th>
      <th class="col-sm-2">{% trans "Eindtijd" %}</th>
      <th class="col-sm-4">{% trans "Ritnummer" %}</th>
      <td class="col-sm-1" align="center" style="vertical-align:middle;"><span class="glyphicon glyphicon-random" title="Rit ingekort"></span></td>
      <td class="col-sm-1" align="center" style="vertical-align:middle;"><span class="glyphicon glyphicon-ban-circle" title="Niet gevolgd"></span></td>
      <td class="col-sm-1" align="center" style="vertical-align:middle;"><span class="glyphicon glyphicon-eye-close" title="Toon opgeheven rit niet"></span></td>
      <td class="col-sm-1" align="center" style="vertical-align:middle;"><span class="glyphicon glyphicon-transfer" title="Automatisch herstellen"></span></td>
      <th class="col-sm-1"></th>
  </tr>
  {% for msg in line.list %}
    <tr>
        <td>{{ msg.operatingday|date:"d-m-Y" }}</td>
        <td>
            {% if msg.begintime %}
                {{ msg.begintime|time:"H:i" }}
            {% endif %}
        </td>
        <td>
            {% if msg.endtime %}
                {{ msg.endtime|time:"H:i" }}
            {% endif %}
        </td>
        <td>
            {% if msg.journey %}
                {{ msg.journey.journeynumber }} <small>(Vertrek {{ msg.journey.departuretime|seconds_time|date:"H:i"}})</small>
            {% elif all_lines %}
                {{ all_lines }}
            {% else %}
                {% trans "Alle ritten" %}
            {% endif %}
        </td>

        {% if msg.shorten_details.all %}
            <td align="center" style="vertical-align:middle;">
                <a class="shorten_halte-count btn btn-link" id="shorten_halte-count" href="{% url 'shorten_view' msg.id %}"
                       data-title="{% trans 'Haltes bij inkorting' %}" data-html="true" data-content="{% include 'openebs/snippet_halte-list_shorten.html' %}">
                        {{ msg.shorten_details.all | length }}</a>
            </td>
            <td align="center" style="vertical-align:middle;">
                {% if msg.monitoring_error %}
                    <span class="glyphicon glyphicon-ban-circle" title="Niet gevolgd"></span>
                {% endif %}
            </td>
            <td align="center" style="vertical-align:middle;">
                {% if msg.showcancelledtrip == False %}
                    <span class="glyphicon glyphicon-eye-close" title="Toon opgeheven rit niet"></span>
                {% endif %}</td>
            <td></td>
        {% elif msg.monitoring_error %}
            <td></td>
            <td align="center" style="vertical-align:middle;"><span class="glyphicon glyphicon-ban-circle" title="Niet gevolgd"></span></td>
                <td></td>
                <td></td>
        {% else %}
            <td></td>
            <td></td>
            <td align="center" style="vertical-align:middle;">
                {% if not msg.showcancelledtrip %}
                    <span class="glyphicon glyphicon-eye-close" title="Toon opgeheven rit niet"></span>
                {% endif %}
            </td>
            <td align="center" style="vertical-align:middle;">
                {% if msg.autorecover %}
                    <span class="glyphicon glyphicon-transfer" title="Automatisch herstellen"></span>
                {% endif %}
        {% endif %}
        <td>
            {% if msg.journey and perms.openebs.add_change %}
                <form method="post" action="{% url 'change_delete' msg.id %}">
                    {% csrf_token %}
                    <button class="btn btn-xs btn-danger pull-right">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </form>
            {% elif msg.line and perms.openebs.cancel_lines %}
                <form method="post" action="{% url 'change_delete' msg.id %}">
                    {% csrf_token %}
                    <button class="btn btn-xs btn-danger pull-right">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </form>
            {% elif not msg.journey and not msg.line and perms.openebs.cancel_alllines%}
                <form method="post" action="{% url 'change_delete' msg.id %}">
                    {% csrf_token %}
                    <button class="btn btn-xs btn-danger pull-right">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </form>
            {% endif %}
        </td>
    </tr>
  {% endfor %}
  </table>